<app-header></app-header>
<div class="container flex">
  <!-- Panel Kiri -->
  <div class="panel-left w-1/4 p-4 border-r border-gray-300 pr-4 bg-white overflow-y-auto h-screen">
    <h2 class="text-lg font-semibold mb-2">Folders</h2>
    <ul class="space-y-1">
      <ng-container *ngFor="let folder of allFolders">
        <ng-template [ngTemplateOutlet]="recursiveList" [ngTemplateOutletContext]="{ $implicit: folder }"></ng-template>
      </ng-container>
    </ul>
  </div>

  <ng-template #recursiveList let-folder>
    <li class="cursor-pointer">
      <div class="flex items-center justify-between py-1 hover:bg-gray-200 rounded px-2">
        <a class="text-gray-800" (click)="onFolderClick(folder.id)">
          📁 {{ folder.name }} (<span class="text-gray-500 text-sm">{{ folder.children?.length || 0 }}</span>)
        </a>
        <!-- Icon untuk Expand/Collapse -->
        <i class="fas" [ngClass]="folder.isOpen ? 'fa-chevron-down' : 'fa-chevron-right'"
           (click)="folder.isOpen = !folder.isOpen"
           style="cursor: pointer;"></i>
      </div>
      <ul *ngIf="folder.isOpen" class="pl-4">
        <ng-container *ngFor="let child of folder.children">
          <ng-template [ngTemplateOutlet]="recursiveList"
                       [ngTemplateOutletContext]="{ $implicit: child }"></ng-template>
        </ng-container>
      </ul>
    </li>
  </ng-template>

  <!-- Panel Kanan -->
  <div class="panel-right w-3/4 p-4">
    <nav class="flex mb-2" aria-label="Breadcrumb">
      <ng-container *ngFor="let folder of breadcrumb; let first = first">
        <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
          <li class="inline-flex items-center">
            <ng-container *ngIf="!first">
              <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true"
                   xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="m1 9 4-4-4-4"/>
              </svg>
            </ng-container>
            <a href="#" (click)="onFolderClick(folder.id)"
               class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
              {{ folder.name }}
            </a>
          </li>
        </ol>
      </ng-container>
    </nav>

    <h3 class="text-lg font-semibold mb-2">
      Subfolders (<span class="text-gray-500 text-lg">{{ subFolders?.length || 0 }}</span>):
    </h3>
    <button (click)="onclickFolder()" type="button" class="mb-2 flex justify-between flex-wrap items-center">
      <ng-container *ngIf="!visibleFolder">
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24">
          <path d="M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z"/>
        </svg>
      </ng-container>
      <ng-container *ngIf="visibleFolder">
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24">
          <path d="M0 10h24v4h-24z"/>
        </svg>
      </ng-container>
      &nbsp;
      <p>{{ formAddFolder ? "Cancel" : "Create Folder" }}</p>
    </button>

    <ng-container *ngIf="visibleFolder">
      <div class="mb-2">
        <input type="text" [(ngModel)]="newFolderName" placeholder="New folder name" class="border p-2 rounded w-full">
        <button (click)="createFolder()" class="mt-2 w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
          Create Folder
        </button>
      </div>
    </ng-container>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <div *ngFor="let subfolder of subFolders"
           class="bg-white shadow-md rounded-lg p-4 cursor-pointer hover:shadow-lg transition duration-200">
        <div class="flex items-center">
          <span class="mr-2 text-gray-600">📁</span>
          <a (click)="onFolderClick(subfolder.id)" class="text-gray-800 hover:text-blue-600 font-semibold">
            {{ subfolder.name }}
          </a>
        </div>
      </div>
    </div>

    <h3 class="text-lg font-semibold mt-4 mb-2">Files (<span
      class="text-gray-500 text-lg">{{ files?.length || 0 }}</span>):</h3>
    <button (click)="onclickFile()" type="button" class="mb-2 flex justify-between flex-wrap items-center">
      <ng-container *ngIf="!visibleFile">
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24">
          <path d="M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z"/>
        </svg>
      </ng-container>
      <ng-container *ngIf="visibleFile">
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24">
          <path d="M0 10h24v4h-24z"/>
        </svg>
      </ng-container>
      &nbsp;
      <p>{{ formAddFile ? "Cancel" : "Create File" }}</p>
    </button>

    <ng-container *ngIf="visibleFile">
      <div class="mb-2">
        <input type="text" [(ngModel)]="newFileName" placeholder="New file name" class="border p-2 rounded w-full">
        <button (click)="createFiles()" class="mt-2 w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
          Create File
        </button>
      </div>
    </ng-container>

    <ul class="space-y-1">
      <li *ngFor="let file of files" class="flex items-center p-2 hover:bg-gray-100 rounded">
        📄 {{ file.name }}
      </li>
    </ul>
  </div>
</div>
